<?php

/*
Since we're not using WordPress for pages, we have to manually handle routing to the proper template. This switch statement will need to reflect the entire catalog of pages.
*/
// **TODO this needs to handle nested pages (i.e. /platform/ecosystem/oracle)
  // ideally nested depth is flexible (right now hard coded up to 3 levels deep)
  // Basically just need the URL path and the locate_template source to include nesting i.e. platform/subpage
add_action('init', 'customRouter');
function customRouter() {
  $url_path = trim(parse_url(add_query_arg(array()), PHP_URL_PATH), '/');
  switch ($url_path) {
    {{#with nav}}
    {{#each items}}
    case "{{slug}}": $load = locate_template('{{slug}}.php', true); break;
        {{#if subnav}}
        {{#with subnav}}
        {{#each items}}
    case "{{../../this.slug}}/{{slug}}": $load = locate_template('{{../../this.slug}}/{{slug}}.php', true); break;
            {{#if subnav}}
            {{#with subnav}}
            {{#each items}}
    case "{{../../../../this.slug}}/{{../../this.slug}}/{{slug}}": $load = locate_template('{{../../../../this.slug}}/{{../../this.slug}}/{{slug}}.php', true); break;
            {{/each}}
            {{/with}}
            {{/if}}
        {{/each}}
        {{/with}}
        {{/if}}
    {{/each}}
    {{/with}}
    default:
    {{!-- Do we need a default? --}}
  }
  if ($load) {
        exit();
  }
}


add_action( 'init', 'custom_post_types' );
function custom_post_types() {
  {{> utilities/post-type post-type="resources" name="Resources" singular="Resource" icon="dashicons-format-aside" supports="" }}
  {{> utilities/post-type post-type="news" name="News Items" singular="News Item" icon="dashicons-megaphone" supports="" }}
  {{> utilities/post-type post-type="team" name="Team" singular="Member" icon="dashicons-groups" supports="" }}
  {{> utilities/post-type post-type="jobs" name="Private Jobs" singular="Private Job" icon="dashicons-businessman" supports="" }}
}

add_action( 'init', 'resource_taxonomies', 0 );
function resource_taxonomies() {
  {{> utilities/enable-categories for-type="resources" name="Resource Types" singular="Resource Type" slug="resource-type"}}
  {{> utilities/enable-categories for-type="news" name="News Types" singular="News Type" slug="news-type"}}
  {{> utilities/enable-categories for-type="team" name="Groups" singular="Group" slug="group"}}
}

add_action( 'admin_menu', 'remove_pages_from_menu' );
function remove_pages_from_menu(){
  remove_menu_page( 'edit.php?post_type=page' );
  remove_menu_page( 'edit-comments.php' );
}

